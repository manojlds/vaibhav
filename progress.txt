## Codebase Patterns
- `VAIBHAV_VERSION` is the single source of truth for version, defined at top of `bin/vaibhav`
- `bin/vaibhav-ralph` defers version to `bin/vaibhav --version` via exec
- Repo root for desktop update is resolved via `readlink -f ~/bin/vaibhav`, then two levels up
- `update_desktop` function pattern: check dirty state → git pull → compare versions
- `update_termux` function pattern: download to temp dir → verify checksums → atomic copy into place
- Platform detection for update: `VAIBHAV_DESKTOP_HOST` set + hostname mismatch = Termux; otherwise desktop
- `update` command must be in the local-execution list in the remote-mode case block (alongside `init`) to avoid SSH redirect
- SSH remote commands: use single quotes inside double-quoted SSH command strings so `$remote_repo` (local var) expands client-side, while `$HOME` etc. expand server-side
- When checking exit codes only (not output), don't capture into a variable — avoids SC2034 unused-variable warnings
- Color helpers (RED, GREEN, YELLOW, CYAN, BOLD, DIM, NC) are defined in both scripts
- Step/output helpers: use `echo -e` with color vars for status messages
- Pre-existing shellcheck warnings exist (unused BLUE var, SC1090 source, SC1010 `done` as var name) — no errors at `-S error` level
---

# Ralph Progress Log
Started: Tue Feb 17 01:14:54 AM GMT 2026
---

## 2026-02-17 - US-002
Thread: https://ampcode.com/threads/T-019c692b-6be1-7569-b39e-175c8c34ab7f
- Created `bin/generate-checksums` script that generates `checksums.sha256` in repo root
- Checksums cover `bin/vaibhav`, `bin/vaibhav-ralph`, and `tmux.conf` in standard sha256sum format
- Script is idempotent (overwrites existing file), verifies all source files exist before generating
- Files changed: bin/generate-checksums (new), checksums.sha256 (new)
- **Learnings for future iterations:**
  - Script resolves repo root via `readlink -f` on itself, then `..` — same pattern used by vaibhav's ralph dispatch
  - checksums.sha256 will need regeneration whenever tracked files change (US-004 depends on this file being committed)
---

## 2026-02-17 - US-001
Thread: https://ampcode.com/threads/T-019c692a-25a3-76b9-a770-f7d6ccc688ac
- Bumped VAIBHAV_VERSION from 0.2.0 to 0.3.0 in bin/vaibhav
- Changed `vaibhav --version` to print plain text ("vaibhav 0.3.0") instead of ANSI-formatted output
- Added `version|--version|-v` command to vaibhav-ralph that defers to `bin/vaibhav --version`
- Files changed: bin/vaibhav, bin/vaibhav-ralph
- **Learnings for future iterations:**
  - shellcheck is not pre-installed; download to ~/.local/bin from GitHub releases
  - Pre-existing shellcheck warnings are all warnings/style, no errors at `-S error` level
  - The version string in show_usage() header still uses ANSI formatting (that's intentional — only `--version` needs plain output)
---

## 2026-02-17 - US-004
Thread: https://ampcode.com/threads/T-019c692d-57f8-779c-9f96-b49432389d3e
- Added `update_termux` function to `bin/vaibhav` for Termux-side updates
- Downloads bin/vaibhav, bin/vaibhav-ralph, and checksums.sha256 from GitHub raw URLs
- Uses Cache-Control: no-cache header on all curl requests
- Downloads to temp dir (mktemp), verifies SHA256 checksums, then copies into place
- Trap ensures temp files are cleaned up on failure
- Compares version + checksums to detect "already up to date" state
- Added `update` to the local-execution list in the remote-mode SSH block
- Platform detection in main dispatch routes to update_termux vs update_desktop
- Files changed: bin/vaibhav, checksums.sha256
- **Learnings for future iterations:**
  - The remote-mode case block (lines 56-73) intercepts commands before main dispatch — new local commands must be added to the `init|update)` exception list
  - sha256sum output format uses two spaces between hash and filename — `read -r hash filepath` handles this correctly
  - checksums.sha256 paths are relative to repo root (e.g., `bin/vaibhav`), not absolute — Termux update must reconstruct this structure for verification
  - US-005 will need to add SSH desktop update after local Termux update, plus `--local` flag support
---

## 2026-02-17 - US-003
Thread: https://ampcode.com/threads/T-019c692c-2bde-73eb-941d-46076d50a641
- Added `update_desktop` function to `bin/vaibhav` implementing `vaibhav update` for desktop
- Resolves repo directory from symlink at `~/bin/vaibhav` (readlink -f, two levels up)
- Shows old→new version after pulling, handles already-up-to-date and dirty-repo cases
- Added `update` to main dispatch and usage help
- Files changed: bin/vaibhav
- **Learnings for future iterations:**
  - `git -C <dir> diff --quiet` checks for unstaged changes; `--cached` for staged — both needed to detect dirty state
  - New version after pull is read from the updated file via grep, not from the running script's variable
  - US-004 (Termux update) will need a different `update` path — dispatch will need platform detection
---

## 2026-02-17 - US-005
Thread: https://ampcode.com/threads/T-019c692f-52e2-74d5-9de1-5f7e0eee477e
- Added `update_desktop_remote` function to `bin/vaibhav` for SSH-based desktop update from Termux
- Discovers desktop repo path via `readlink -f ~/bin/vaibhav` over SSH, then dirname twice
- Checks for dirty state on desktop before pulling; warns and skips if dirty
- Shows version transition or "already up to date" for desktop
- All SSH failures are warnings (return 0) — local update is still considered successful
- Added `--local` flag support in the `update` dispatch to skip desktop update
- Files changed: bin/vaibhav
- **Learnings for future iterations:**
  - In SSH command strings, use single quotes around `$remote_repo` (local var that expands client-side) vs `$HOME` (expands server-side)
  - SC2029 info messages for client-side expansion are expected and intentional for this pattern
  - `local` keyword can't be used in top-level `case` blocks — use plain variable assignment instead
---
